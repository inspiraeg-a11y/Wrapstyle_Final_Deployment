<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²Ù†</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f1f5f9; }
        .card { background: white; padding: 25px; border-radius: 10px; max-width: 1200px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #0f172a; color: white; }
        .btn { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; color: white; font-size: 12px; margin: 0 2px; }
        .btn-edit { background: #f59e0b; } .btn-del { background: #ef4444; }
    </style>
</head>
<body>
<div class="card">
    <h2>ğŸ“Š Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
    <table id="tbl">
        <thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø§Ù„ØªÙƒÙ„ÙØ©</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody id="tbody"></tbody>
    </table>
</div>
<script>
    const API = 'http://localhost:5000/api';
    async function load() {
        try {
            const res = await fetch(`${API}/products`);
            const data = await res.json();
            document.getElementById('tbody').innerHTML = data.map(p => {
                const stock = p.currentStock || 0;
                let cost = p.pricing?.unitCost || 0;
                if(cost===0 && p.dimensions?.area>0) cost = p.pricing.purchasePrice/p.dimensions.area;
                return `<tr>
                    <td>${p.code}</td>
                    <td>${p.name}</td>
                    <td style="font-weight:bold">${stock.toFixed(2)}</td>
                    <td>${cost.toFixed(4)}</td>
                    <td>${(stock*cost).toFixed(2)}</td>
                    <td>${stock<=0 ? 'âŒ' : 'âœ…'}</td>
                    <td>
                        <button class="btn btn-edit" onclick="location.href='products.html?id=${p._id}'">âœï¸</button>
                        <button class="btn btn-del" onclick="del('${p._id}')">ğŸ—‘ï¸</button>
                    </td>
                </tr>`;
            }).join('');
        } catch(e) { alert('Ø®Ø·Ø£ ØªØ­Ù…ÙŠÙ„'); }
    }
    async function del(id) {
        if(!confirm('Ø­Ø°Ù Ø§Ù„ØµÙ†ÙØŸ')) return;
        await fetch(`${API}/products/${id}`, { method: 'DELETE' });
        load();
    }
    load();
</script>
</body>
</html>