<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù…</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f8fafc; }
        .card { background: white; padding: 30px; border-radius: 10px; max-width: 600px; margin: 20px auto; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #0f766e; margin-top: 0; }
        select, input[type=file] { padding: 10px; width: 90%; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; width: 90%; margin-top: 10px; }
        .btn-export { background: #0ea5e9; }
        .btn-import { background: #10b981; }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø± */
        .danger-zone { border: 2px solid #fee2e2; background: #fff5f5; margin-top: 40px; padding: 20px; border-radius: 10px; }
        .danger-zone h2 { color: #991b1b; }
        .btn-reset { background: #ef4444; } .btn-reset:hover { background: #b91c1c; }
        .btn-full-reset { background: #7f1d1d; }
        
        #msg { margin-top:15px; font-weight:bold; display:none; padding:10px; border-radius:5px; }
        hr { margin: 20px 0; border: 0; border-top: 1px solid #eee; }
    </style>
</head>
<body>

<!-- 1. Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ (ÙƒÙ…Ø§ Ù‡Ùˆ) -->
<div class="card">
    <h2>ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Backup)</h2>
    <select id="exportType">
        <optgroup label="Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©">
            <option value="products">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</option>
            <option value="customers">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
            <option value="suppliers">ğŸ­ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
            <option value="cars">ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>
            <option value="employees">ğŸ‘” Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
            <option value="accounts">ğŸ’° Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</option>
        </optgroup>
        <optgroup label="Ø§Ù„Ø­Ø±ÙƒØ§Øª">
            <option value="sales_invoices">ğŸ›’ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
            <option value="purchase_invoices">ğŸ§¾ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</option>
            <option value="stock_transactions">ğŸ—ï¸ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²Ù†</option>
            <option value="payroll">ğŸ’° Ø§Ù„Ø±ÙˆØ§ØªØ¨</option>
            <option value="treasury">ğŸ’¸ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</option>
        </optgroup>
    </select>
    <button class="btn btn-export" onclick="exportData()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel</button>
</div>

<div class="card">
    <h2>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
    <select id="importType">
        <!-- Ù†ÙØ³ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
        <option value="products">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</option>
        <option value="customers">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
        <option value="suppliers">ğŸ­ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
        <option value="cars">ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>
        <option value="employees">ğŸ‘” Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
        <option value="accounts">ğŸ’° Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</option>
        <option value="sales_invoices">ğŸ›’ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
        <option value="purchase_invoices">ğŸ§¾ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</option>
        <option value="stock_transactions">ğŸ—ï¸ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²Ù†</option>
        <option value="payroll">ğŸ’° Ø§Ù„Ø±ÙˆØ§ØªØ¨</option>
        <option value="treasury">ğŸ’¸ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</option>
    </select>
    <input type="file" id="importFile" accept=".xlsx, .xls">
    <button class="btn btn-import" onclick="importData()">â¬†ï¸ Ø±ÙØ¹ ÙˆØªØ­Ø¯ÙŠØ«</button>
</div>

<!-- 2. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø± (Ø§Ù„Ø¬Ø¯ÙŠØ¯) -->
<div class="card danger-zone">
    <h2>â˜ ï¸ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø± (Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)</h2>
    <p style="color:#b91c1c; font-size:13px;">ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.</p>
    
    <button class="btn btn-reset" onclick="resetData('transactions')">
        ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø­Ø±ÙƒØ§Øª ÙÙ‚Ø· ÙˆØªØµÙÙŠØ± Ø§Ù„Ø£Ø±ØµØ¯Ø©
        <br><small>(ÙŠØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ†)</small>
    </button>
    
    <button class="btn btn-full-reset" onclick="resetData('all')">
        ğŸ’£ Ù…Ø³Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Factory Reset)
        <br><small>(ÙŠØ­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ ÙˆÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ±)</small>
    </button>
</div>

<div id="msg"></div>

<script>
    const API = 'http://localhost:5000/api/data';

    function exportData() {
        const type = document.getElementById('exportType').value;
        window.location.href = `${API}/export/${type}`;
    }

    async function importData() {
        const type = document.getElementById('importType').value;
        const fileInput = document.getElementById('importFile');
        const msgDiv = document.getElementById('msg');
        
        if (!fileInput.files[0]) { alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!'); return; }

        if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰: ${type}ØŸ\nØ³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.`)) return;

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        msgDiv.style.display = 'block';
        msgDiv.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ø±Ø¨Ø·...';
        msgDiv.style.background = '#e0f2fe';
        msgDiv.style.color = '#0369a1';
        
        try {
            const res = await fetch(`${API}/import/${type}`, { method: 'POST', body: formData });
            const json = await res.json();
            
            if (res.ok) {
                msgDiv.innerText = 'âœ… ' + json.message;
                msgDiv.style.background = '#dcfce7';
                msgDiv.style.color = '#166534';
            } else {
                msgDiv.innerText = 'âŒ Ø®Ø·Ø£: ' + (json.message || 'ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
                msgDiv.style.background = '#fee2e2';
                msgDiv.style.color = '#991b1b';
            }
        } catch (e) { 
            msgDiv.innerText = 'âŒ Ø®Ø·Ø£ ÙØ§Ø¯Ø­ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±'; 
            msgDiv.style.background = '#fee2e2';
            msgDiv.style.color = '#991b1b';
        }
    }

    // ğŸ‘‡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ğŸ‘‡
    async function resetData(scope) {
        let confirmMsg = "";
        if (scope === 'transactions') {
            confirmMsg = "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ù‚ÙŠÙˆØ¯ ÙˆØªØµÙÙŠØ± Ø§Ù„Ù…Ø®Ø§Ø²Ù†ØŒ Ù„ÙƒÙ† Ø³ØªØ¨Ù‚Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª.";
        } else {
            confirmMsg = "âš ï¸ ØªØ­Ø°ÙŠØ± Ø®Ø·ÙŠØ±!! Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆÙƒØ£Ù†Ù‡ Ø¬Ø¯ÙŠØ¯. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ØŸ";
        }

        if (!confirm(confirmMsg)) return;
        // ØªØ£ÙƒÙŠØ¯ ØªØ§Ù†ÙŠ Ù„Ù„Ø£Ù…Ø§Ù†
        if (!confirm("ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) return;

        document.getElementById('msg').style.display = 'block';
        document.getElementById('msg').innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ...';
        document.getElementById('msg').style.background = '#fee2e2';

        try {
            const res = await fetch(`${API}/reset`, { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ scope }) 
            });
            const json = await res.json();
            
            if (res.ok) {
                document.getElementById('msg').innerText = 'âœ… ' + json.message;
                document.getElementById('msg').style.background = '#dcfce7';
                document.getElementById('msg').style.color = '#166534';
            } else {
                document.getElementById('msg').innerText = 'âŒ Ø®Ø·Ø£: ' + json.message;
            }
        } catch (e) { alert('Ø®Ø·Ø£ Ø§ØªØµØ§Ù„'); }
    }
</script>
</body>
</html>