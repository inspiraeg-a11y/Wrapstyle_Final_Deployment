<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f1f5f9; }
        .card { background: white; padding: 25px; border-radius: 10px; max-width: 1200px; margin: 0 auto; margin-bottom: 20px; }
        
        .bal-grid { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .bal-card { background: #1e293b; color: white; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px; text-align: center; }
        .bal-val { font-size: 24px; font-weight: bold; color: #4ade80; display: block; margin-top: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #e0f2fe; color: #0369a1; }
        
        .btn { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; color: white; margin: 0 2px; }
        .btn-edit { background: #f59e0b; } .btn-del { background: #ef4444; } .btn-print { background: #3b82f6; }
        .btn-new { background: #10b981; padding: 8px 15px; text-decoration: none; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ’° Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø®Ø²Ø§Ø¦Ù† ÙˆØ§Ù„Ø¨Ù†ÙˆÙƒ</h2>
    <div class="bal-grid" id="balContainer">Loading...</div>
</div>

<div class="card">
    <h2 style="display:flex; justify-content:space-between">
        ğŸ“œ Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
        <a href="treasury.html" class="btn-new">+ Ø¥Ø°Ù† Ø¬Ø¯ÙŠØ¯</a>
    </h2>
    <table>
        <thead><tr><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø®Ø²ÙŠÙ†Ø©</th><th>Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±</th><th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<script>
    const API = 'http://localhost:5000/api';

    async function load() {
        // Ø§Ù„Ø£Ø±ØµØ¯Ø©
        const balRes = await fetch(`${API}/treasury/balances/summary`);
        const bals = await balRes.json();
        document.getElementById('balContainer').innerHTML = bals.map(b => `
            <div class="bal-card"><div>${b.name}</div><span class="bal-val">${b.balance.toLocaleString()}</span></div>
        `).join('');

        // Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const listRes = await fetch(`${API}/treasury`);
        const list = await listRes.json();
        document.getElementById('tbody').innerHTML = list.map(t => `
            <tr>
                <td>${t.serialNumber}</td>
                <td>${new Date(t.date).toLocaleDateString('ar-EG')}</td>
                <td style="color:${t.type==='Inbound'?'green':'red'}">${t.type==='Inbound'?'Ù‚Ø¨Ø¶':'ØµØ±Ù'}</td>
                <td style="font-weight:bold">${t.amount.toLocaleString()}</td>
                <td>${t.treasuryAccount?.name}</td>
                <td>${t.targetAccount?.name}</td>
                <td>${t.paymentMethod}</td>
                <td>
                    <button class="btn btn-print" onclick="window.open('treasury_print.html?id=${t._id}','_blank','width=800,height=600')">ğŸ–¨ï¸</button>
                    <button class="btn btn-edit" onclick="location.href='treasury.html?id=${t._id}'">âœï¸</button>
                    <button class="btn btn-del" onclick="del('${t._id}')">ğŸ—‘ï¸</button>
                </td>
            </tr>
        `).join('');
    }

    async function del(id) {
        if(!confirm('Ø­Ø°Ù Ø§Ù„Ø¥Ø°Ù†ØŸ (Ø³ÙŠØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø§Ù„ÙŠ)')) return;
        await fetch(`${API}/treasury/${id}`, { method: 'DELETE' });
        alert('ØªÙ… Ø§Ù„Ø­Ø°Ù'); load();
    }

    load();
</script>
</body>
</html>