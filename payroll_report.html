<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ø¬Ù„ Ø§Ù„Ø±ÙˆØ§ØªØ¨</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f1f5f9; }
        .card { background: white; padding: 25px; border-radius: 10px; max-width: 1100px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #1e293b; color: white; }
        
        .btn { padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 12px; font-weight: bold; border: none; cursor: pointer; margin: 0 2px; color: white; }
        .btn-view { background: #3b82f6; }
        .btn-post { background: #10b981; }
        .btn-del { background: #ef4444; }
    </style>
</head>
<body>
<div class="card">
    <h2>ğŸ“… Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ØµØ±ÙˆÙØ©</h2>
    <div style="text-align:center">
        <label>ÙÙ„ØªØ± Ø¨Ø§Ù„Ø´Ù‡Ø±:</label> <input type="month" id="month">
        <button onclick="load()" style="background:#3b82f6; color:white; padding:5px 15px; border:none; cursor:pointer">Ø¨Ø­Ø«</button>
    </div>
    <p style="font-size:13px; color:#666; text-align:center">Ø¨Ø¹Ø¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù‚ÙŠØ¯" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø§Ù„Ù…ÙØµÙ„.</p>
    <table id="tbl"><thead><tr><th>Ø§Ù„Ø´Ù‡Ø±</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ±Ù</th><th>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</th><th>Ø§Ù„ØµØ§ÙÙŠ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody></tbody></table>
</div>
<script>
    const API = 'http://localhost:5000/api/hr';
    async function load() {
        const month = document.getElementById('month').value;
        const url = month ? `${API}/payroll?month=${month}` : `${API}/payroll`;
        const res = await fetch(url);
        const data = await res.json();
        
        document.querySelector('tbody').innerHTML = data.map(p => `
            <tr>
                <td style="font-weight:bold">${p.month}</td>
                <td>${new Date(p.date).toLocaleDateString('ar-EG')}</td>
                <td>${p.details.length}</td>
                <td style="font-weight:bold; color:green">${p.totalAmount.toLocaleString()}</td>
                <td>${p.status === 'Posted' ? 'âœ… Ù…Ø±Ø­Ù„' : 'âš ï¸ Ù…Ø³ÙˆØ¯Ø©'}</td>
                <td>
                    <a href="payroll.html?viewMonth=${p.month}" class="btn btn-view">ğŸ‘ï¸ Ø¹Ø±Ø¶</a>
                    <button class="btn btn-post" onclick="postEntry('${p._id}')">âš™ï¸ ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù‚ÙŠØ¯</button>
                    <button class="btn btn-del" onclick="del('${p._id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </td>
            </tr>
        `).join('');
    }

    async function postEntry(id) {
        if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø§Ù„Ù…ÙØµÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±ØŸ')) return;
        try {
            const res = await fetch(`${API}/payroll/${id}/post`, { method: 'POST' });
            const json = await res.json();
            if(res.ok) { alert(json.message); load(); }
            else { alert('Ø®Ø·Ø£: ' + json.message); }
        } catch(e) { alert('Ø®Ø·Ø£ Ø§ØªØµØ§Ù„'); }
    }

    async function del(id) {
        if(!confirm('ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù ÙˆØ¥Ù„ØºØ§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ ÙˆØ¹ÙƒØ³ Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª!')) return;
        try {
            const res = await fetch(`${API}/payroll/${id}`, { method: 'DELETE' });
            if(res.ok) { alert('ØªÙ… Ø§Ù„Ø­Ø°Ù'); load(); }
            else { alert('ÙØ´Ù„'); }
        } catch(e) { alert('Ø®Ø·Ø£ Ø§ØªØµØ§Ù„'); }
    }

    load();
</script>
</body>
</html>