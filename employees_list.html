<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f1f5f9; }
        .card { background: white; padding: 25px; border-radius: 10px; max-width: 1200px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #e0f2fe; color: #0369a1; }
        .btn { padding: 5px 10px; border-radius: 4px; cursor: pointer; color: white; border:none; text-decoration:none; font-size:13px; }
        .btn-edit { background: #f59e0b; }
        .btn-del { background: #ef4444; }
        .btn-new { background: #10b981; padding: 10px 20px; font-weight: bold; font-size:14px; }
    </style>
</head>
<body>
<div class="card">
    <h2 style="display:flex; justify-content:space-between">
        ğŸ‘¥ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (HR)
        <a href="employee_coding.html" class="btn-new">+ Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</a>
    </h2>
    <input id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯..." onkeyup="filterTable()" style="padding:10px; width:300px; border:1px solid #ccc; border-radius:5px; margin-bottom:10px;">
    <table id="tbl"><thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ø§Ù…Ù„</th><th>Ø±ØµÙŠØ¯ Ø¥Ø¬Ø§Ø²Ø§Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody id="tbody"></tbody></table>
</div>
<script>
    const API = 'http://localhost:5000/api/hr';
    let employees = [];

    async function load() {
        try {
            const res = await fetch(`${API}/employees`);
            employees = await res.json();
            render(employees);
        } catch(e) { alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±'); }
    }

    function render(list) {
        const tbody = document.getElementById('tbody');
        if(list.length === 0) { tbody.innerHTML = '<tr><td colspan="7">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</td></tr>'; return; }
        
        tbody.innerHTML = list.map(e => `
            <tr>
                <td>${e.code || '-'}</td>
                <td style="font-weight:bold">${e.name}</td>
                <td>${e.jobTitle || '-'}</td>
                <td>${e.department || '-'}</td>
                <td style="color:green; font-weight:bold">${e.totalSalary || 0}</td>
                <td>${e.vacationBalance || 0}</td>
                <td>
                    <a href="employee_coding.html?id=${e._id}" class="btn btn-edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
                    <button class="btn btn-del" onclick="del('${e._id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </td>
            </tr>
        `).join('');
    }

    function filterTable() {
        const term = document.getElementById('search').value.toLowerCase();
        const filtered = employees.filter(e => e.name.toLowerCase().includes(term) || (e.code && e.code.toLowerCase().includes(term)));
        render(filtered);
    }

    // ğŸ‘‡ğŸ‘‡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…ÙØ¹Ù„Ø© ğŸ‘‡ğŸ‘‡
    async function del(id) {
        if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
        
        try {
            const res = await fetch(`${API}/employees/${id}`, { method: 'DELETE' });
            if(res.ok) {
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                load(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            } else {
                const json = await res.json();
                alert('Ø®Ø·Ø£: ' + json.message);
            }
        } catch(e) { alert('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±'); }
    }

    load();
</script>
</body>
</html>